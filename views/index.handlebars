{{!-- {{#each snippets}}
<pre><code>{{snippetBody}}</code></pre>
{{/each}} --}}

<div class="container">
  <div class="row">
    {{!-- This column size controls the overall column width of the box div containing both filter dropdowns --}}
    <div class="col-sm-6"> 
      <div class="row">
        {{!-- controls the generic filters --}}
        <div class="filterBtn col-6 dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false" style="width: 100%;">
            <p id="mainFilterTitle">All</p>
          </button>
          <div class="dropdown-menu" id="languageDropDown" aria-labelledby="dropdownMenuButton">
            {{!-- for each entry in filterSet --}}
            {{!-- <a class="dropdown-item" id="dd{{name}}" href="#">{{name}}</a> --}}
            <a class="dropdown-item ddLanguage" id="ddAll" href="#">All</a>
            <a class="dropdown-item ddLanguage" id="ddJavascript" href="#">Javascript</a>
            <a class="dropdown-item ddLanguage" id="ddHTML" href="#">Html</a>
            <a class="dropdown-item ddLanguage" id="ddCSS" href="#">CSS</a>
            {{!-- <a class="dropdown-item" class="ddLanguage" id="ddTag1"href="#">Tag 1</a> --}}
          </div>
        </div>

        {{!-- controls the date-based filter --}}
        <div class="filterBtn col-6 dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false" style="width: 100%;">
            <p>Order by Date</p </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item ddCreationDate" id="asc" href="#">Date : Ascending </a>
              <a class="dropdown-item ddCreationDate" id="desc" href="#">Date : Descending</a>
            </div>
        </div>
      </div>
    </div>
  </div>

  <div class="jumbotron">
    <h1>Snippet Bank</h1>
    <h3>[rough template]</h3>
    <hr>
    <button id="addSnippet" class="btn btn-danger btn-lg"><span class="fa fa-plus"></span> Add New Snippet</button>
  </div>

  <!-- This is the form where a new character is added -->
  <div class="row">
    <div class="col-3 list-container">
      <div class="card">
        <ul class="list-group">
          {{#each snippets}}
          <li value={{id}}>{{snippetTitle}}</li>
          {{/each}}
        </ul>
      </div>
    </div>
    <div class="col-9">
      <form id="newSnippetArea" style="display: none;" action="/" method="POST" name="snippets" class="form-group">
        <label>snippetTitle</label>
        <input type="text" class="form-control" name="newTitle" id="newTitle" value="" />

        <label>language</label>
        <input type="text" class="form-control" name="newLanguage" id="newLanguage" value="" />

        <label>description</label>
        <textarea type="text" class="form-control" name="newDescription" id="newDescription" value=""></textarea>

        <label>snippetBody</label>
        <textarea type="text" class="form-control" name="newSnippetBody" id="newSnippetBody" value=""></textarea>

        <button type="submit" id="submitSnippet" class="btn btn-primary">Save</button>
      </form>

      <h2 id="bodyTitle"></h2>
      <pre><code id="bodySnippetBody"></code></pre>
      <h4 id="bodyDescription"></h4>
      <h4 id="bodyLanguage"></h4>
      <h4 id="bodyDate"></h4>

    </div>
  </div>

</div>

<script>
  //Handling the currently selected language
  const selectedLanguageConst = {{selectedLanguage}} 
  //if there is a selected language then set the dropdown title to the selected option
   $("#mainFilterTitle").text(`${selectedLanguageConst}`)
   console.log($("#mainFilterTitle"))

  //Event handler for the main dropdown
  $(".ddLanguage").on("click", function (event) {
    //Sets the dropdown title to reflect the currently selected option
    $("#mainFilterTitle").text($(this).text())
    //if the option is all then make a seperate select all query
    if ($(this).text() === "All") {
      //then use functions.SelectAll
      const query = "SELECT * FROM snippets;"
      $.ajax({
      url: "/api/filter/" + query,
      method: "get"
    }).then(window.location.assign("/api/filter/" + `${query}`))
    }
    else {
    //or else condtionally select from the database
    const query = `SELECT * FROM snippets WHERE language =` +  `"${$(this).text()}"`
    console.log(query)
    $.ajax({
      url: "/api/filter/" + query,
      method: "get"
    }).then(window.location.assign("/api/filter/" + `${query}`))
    }
  })

  //Event handler for creationdate drop down
  $(".ddCreationDate").on("click", function (event) {
    //if the filter is currently set to all then use a selectAll query
    if ($("#mainFilterTitle").text() === "All") {
      //then use functions.SelectAll
      const query = "SELECT * FROM snippets;"
      $.ajax({
      url: "/api/filter/" + query,
      method: "get"
    }).then(window.location.assign("/api/filter/" + `${query}`))
    }
    else {
    //if the filter is not set to all then use a more selective query
      //Sorts by id in the table, where the actual HTML element supplies the asc or desc in the element id
      const query = "SELECT * FROM snippets " + "WHERE language = " +  `${$("#mainFilterTitle").text()}` + "ORDER by id" +  `${$(this).attr('id')};`
      console.log(query)
      $.ajax({
      url: "/api/filter/" + query,
      method: "get"
    }).then(window.location.assign("/api/filter/" + `${query}`))
    }
    });
  


  // Event handler for "Add New Snippet" button click
  $("#addSnippet").on("click", function (event) {
    event.preventDefault();

    // Show the form for adding a character
    $("#newSnippetArea").show();
  });

  $("li").on("click", function (event) {
    $("#newSnippetArea").hide();
    const id = $(this).val();
    $.ajax({
      url: "api/" + id,
      method: "POST"
      //Send user back to homepage for refresh
    }).then(function (data) {

      $("#bodyTitle").text(data[0].snippetTitle);
      $("#bodySnippetBody").text(data[0].snippetBody);
      $('pre > code').each(function () {
        hljs.highlightBlock(this);
      });
    });

  });

</script>